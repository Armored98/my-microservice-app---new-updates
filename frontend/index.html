{% extends "base.html" %}
{% block body %}
<div class="row justify-content-center">
	<div class="col-md-8">
		<div class="card shadow-sm">
			<div class="card-body">
				<h3 class="card-title mb-4">Your Todos (Now with an automated CI/CD pipeline using the power of DevOps!)</h3>
				{% if not session.get('token') %}
					<div class="alert alert-info">
						Plz ðŸ¤ª <a href="{{ url_for('login') }}" class="alert-link">log in</a> to manage your todos.
					</div>
						{% else %}
							<div class="d-flex justify-content-between align-items-center mb-2">
								<h5 class="mb-0">Todo List</h5>
								<a href="{{ url_for('export') }}" class="btn btn-outline-secondary btn-sm">Export</a>
							</div>
							<ul class="list-group mb-4">
								{% for todo in todos %}
									<li class="list-group-item d-flex justify-content-between align-items-center" style="border-left: 6px solid {% if todo.priority==1 %}#dc3545{% elif todo.priority==2 %}#ffc107{% else %}#28a745{% endif %};">
										<form method="post" class="d-flex align-items-center w-100" style="gap: 10px;">
											<input type="hidden" name="toggle_id" value="{{ todo.id }}">
											<input type="hidden" name="done" value="{{ 0 if todo.done else 1 }}">
											<input class="form-check-input me-2" type="checkbox" onchange="this.form.submit()" {% if todo.done %}checked{% endif %}>
											<span {% if todo.done %}style="text-decoration: line-through; color: #888;"{% endif %}>{{ todo.task }}</span>
										</form>
										<form method="post" class="mb-0">
											<input type="hidden" name="toggle_id" value="{{ todo.id }}">
											<select name="priority" class="form-select form-select-sm" style="width: 110px; min-width: 90px;" onchange="this.form.submit()">
												<option value="1" {% if todo.priority==1 %}selected{% endif %} style="color:#dc3545;">High</option>
												<option value="2" {% if todo.priority==2 %}selected{% endif %} style="color:#ffc107;">Medium</option>
												<option value="3" {% if todo.priority==3 %}selected{% endif %} style="color:#28a745;">Low</option>
											</select>
										</form>
									</li>
								{% else %}
									<li class="list-group-item text-muted">No todos yet.</li>
								{% endfor %}
							</ul>
							<form method="post" class="d-flex align-items-center" style="gap: 10px;" id="add-todo-form">
								<input type="text" name="task" class="form-control me-2" placeholder="New Todo" required>
								<label class="me-1">Priority:</label>
								<select name="priority" class="form-select form-select-sm me-2" style="width: 110px; min-width: 90px;">
									<option value="1" style="color:#dc3545;">High</option>
									<option value="2" style="color:#ffc107;">Medium</option>
									<option value="3" style="color:#28a745;">Low</option>
								</select>
								<button type="submit" class="btn btn-primary">Add</button>
							</form>
							<!-- No JS needed for dropdown version -->
				{% endif %}
			</div>
		</div>
	</div>
</div>
{% endblock %}
